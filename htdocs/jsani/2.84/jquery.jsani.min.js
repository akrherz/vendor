var _JSANI_BASE={options:{baseDir:null,imageSrcs:null,aniWidth:null,aniHeight:null,resizeImagesToFit:true,controls:["stopplay"],maxdwell:1400,mindwell:80,initdwell:160,nsteps:25,first_frame_pause:1,last_frame_pause:1,frame_pause:null,fitContainer:false},_create:function(){this.animIsStopped=false;this.animIsLooping=true;this.animIsZoomed=false;this.zoomLevel=1;this.zoomFactor=1.25;this.frameIndex=0;this.direction="forward";this.imageFrames=[];this.frameLabels=[];this.nImagesLoaded=0;this.imgWidth=null;this.imgHeight=null;this.frameWidth=null;this.frameHeight=null;this.initFrameWidth=null;this.initFrameHeight=null;this.framePosition={x:null,y:null};this.defaultControlsLocation="top";this.frameDwell=null;this.frameDwellPause=[];this.frameDwellPauseCounter=[];this.dwellStepRate=null;this.intervalID=null;this.frameIsBeingDrawn=false;this.progressbar=null;this.controlHeight=null;this.frameIndex--;this.element.addClass("jsani");this.element.removeClass("jsani-error-thrown");if(!this.isCanvasSupported()){this.element.addClass("jsani-error-thrown");this._printErrorMessage(this,'Your web browser does not support HTML5 Canvas.  You will need to use a newer, <a href="http://en.wikipedia.org/wiki/Canvas_element#Browser_support" target="_blank">HTML5 compliant browser</a> to view this animation.');return}var a=this._checkConfig(this.options);if(a!==true){this.element.addClass("jsani-error-thrown");this._printErrorMessage(this,a);return}var c=this._getImageSrcsAndLabels(this,this.options.imageSrcs);this.options.imageSrcs=c.imageSrcs;this.options.frameLabels=c.frameLabels;if(this._propExists(this.options.controls,"controlList","zoom","showzoomHelp")){this.options.showzoomHelp=this.options.controls.controlList.zoom.showzoomHelp}this._createAnimContainer();this._disableTextSelect(this.element);var b=this;b._on(b.element,{jsaniimagespreloaded:function(){b._startAnim()}});this._preloadImages(this)},_getImageSrcsAndLabels:function(k,b){var f=b.length!=0&&k._propExists(b,0)&&(b[0]!==null&&typeof b[0]==="object");var a={};if(f){var g=[];var j=[];for(var c=0;c<b.length;c++){g.push(b[c].img);j.push(b[c].label)}a={imageSrcs:g,frameLabels:j}}else{a.imageSrcs=b;if(k._propExists(k.options,"frameLabels")){a.frameLabels=k.options.frameLabels}else{var d=[];var h=a.imageSrcs.length;var e;for(var c=0;c<a.imageSrcs.length;c++){e=c+1;d.push(e+" / "+h)}a.frameLabels=d}}if(a.imageSrcs.length!=a.frameLabels.length){k._printErrorMessage(k,"ERROR: the number of frame labels does not match the number of images being animated")}return a},_checkConfig:function(a){if(a.imageSrcs==null||a.imageSrcs.length<=0){return"ERROR: no images were specified"}else{return true}},_createAnimContainer:function(){var a=this;if(!this.options.resizeImagesToFit){a._printErrorMessage(a,"ERROR: resizeImagesToFit option not implemented yet")}else{if(this.options.aniWidth!==null&&this.options.aniHeight!==null){this.element.width(this.options.aniWidth);this.element.height(this.options.aniHeight)}else{if(isNaN(this.element.width())||isNaN(this.element.height())){this.element.html("ERROR: invalid JSani container dimenions");return}this.options.aniWidth=this.element.width();this.options.aniHeight=this.element.height()}}this.options.controls=this._updateControlList(this.options.controls);var b=this._createControls(this.options.controls);this.controlHeight=b.height;this.options.aniHeight=this.options.aniHeight-this.controlHeight;if(b.location=="top"){this.element.append('<canvas width="'+this.options.aniWidth+'" height="'+this.options.aniHeight+'" class="jsaniCanvas"></canvas>')}else{this.element.prepend('<canvas width="'+this.options.aniWidth+'" height="'+this.options.aniHeight+'" class="jsaniCanvas"></canvas>')}this._bindEvent("jsaniimagespreloaded",function(c,e){a.setFrameSize();a.setFramePosition(a,"center","top")})},_preloadImages:function(a){a._imageProgressBar(a,"init",null);for(var b=0;b<a.options.imageSrcs.length;b++){a.imageFrames[b]=new Image();a.imageFrames[b].onload=function(){a.nImagesLoaded++;a._imageProgressBar(a,"update",a.nImagesLoaded);a.imgWidth=this.width;a.imgHeight=this.height;if(a.nImagesLoaded>=a.options.imageSrcs.length){a._trigger("imagespreloaded",null,{widget:a.element})}};var c=a.options.baseDir;c=(c==null)?"":$.trim(c);c=(c!="")?c+"/":"";a.imageFrames[b].src=c+a.options.imageSrcs[b]}},_imageProgressBar:function(b,d,c){if(d=="update"){b.progressbar.progressbar("value",c);return}b.element.find("canvas").eq(0).wrap('<div class="jsani-tmp-canvas-wrapper"></div>');b.element.find(".jsani-tmp-canvas-wrapper").eq(0).append('<div class="jsani-progressbar"><div class="jsani-progress-label">Loading...</div></div>');b.progressbar=b.element.find(".jsani-progressbar").eq(0);var a=b.element.find(".jsani-progress-label").eq(0);b.progressbar.progressbar({max:b.options.imageSrcs.length,value:0,change:function(){a.text(b.progressbar.progressbar("value")+" / "+b.options.imageSrcs.length+" preloaded")},complete:function(){b.progressbar.progressbar("destroy");b.progressbar.remove();b.element.find(".jsani-tmp-canvas-wrapper").find(">:first-child").unwrap()}});b._imageProgressBar(b,"update",0)},_startAnim:function(){var a=this;var b=$(this.element).children(".jsaniCanvas").get(0);this.ctx=b.getContext("2d");if(a.animIsStopped){a._drawFrame(a)}else{a._playAnimation(a)}var a=this;$(this.element).children(".jsaniCanvas").eq(0).bind("mouseup",function(c){a._zoomFrame(a,c)})},_drawFrame:function(a,c){c=typeof c!=="undefined"?c:null;if(a.frameIsBeingDrawn){return}var b;if(typeof c=="number"){b=parseInt(c,10)}else{if(c=="first"){b=0}else{if(c=="last"){b=a.imageFrames.length-1}else{if(c==null){if(a.frameDwellPauseCounter[a.frameIndex]>1){a.frameDwellPauseCounter[a.frameIndex]--;return}else{a.frameDwellPauseCounter[a.frameIndex]=a.frameDwellPause[a.frameIndex]}}if(a.animIsLooping){a.direction="forward"}else{if(a.frameIndex==a.imageFrames.length-1){a.direction="backward"}else{if(a.frameIndex==0){a.direction="forward"}}}if(c==null){c=a.direction}if(c=="redraw"){b=a.frameIndex}else{b=(c=="forward")?a.frameIndex+1:a.frameIndex-1;if(b>(a.imageFrames.length-1)){b=0}if(b<0){b=a.imageFrames.length-1}}}}}a.frameIsBeingDrawn=true;a.ctx.clearRect(0,0,100000,100000);a.ctx.drawImage(a.imageFrames[b],a.framePosition.x,a.framePosition.y,a.frameWidth,a.frameHeight);a._updateFrameLabel(a,b);a.frameIsBeingDrawn=false;a.frameIndex=b},_updateFrameLabel:function(a,b){if(!a._propExists(a.options.controls.controlList,"framelabel")){return}$(this.element).find(".jsani-frame-labels").children("li").hide();$(this.element).find(".jsani-frame-labels").children("li").filter('[value="'+b+'"]').show()},setFrameSize:function(d,a){d=typeof d!=="undefined"?d:null;a=typeof a!=="undefined"?a:null;if(d!==null&&a!==null){this.frameWidth=d;this.frameHeight=a;if(this.initFrameWidth==null){this.initFrameWidth=this.frameWidth;this.initFrameHeight=this.frameHeight}return}var f=this.options.aniWidth;var e=this.options.aniHeight;var b=this.imgWidth;var c=this.imgHeight;if(b>f){c=parseInt((c/b)*f,10);b=f}if(c>e){b=parseInt((b/c)*e,10);c=e}this.frameWidth=b;this.frameHeight=c;if(this.initFrameWidth==null){this.initFrameWidth=this.frameWidth;this.initFrameHeight=this.frameHeight}},setFramePosition:function(b,a,c){if(typeof a=="string"){switch(a){case"left":a=0;break;case"right":b._printErrorMessage(b,"ERROR: x == right not supported yet");a=0;break;case"center":if(b.frameWidth<b.options.aniWidth){a=(b.options.aniWidth-b.frameWidth)/2}else{a=0}break;default:a=0}}if(typeof c=="string"){switch(c){case"top":c=0;break;case"bottom":b._printErrorMessage(b,"ERROR: y == bottom not supported yet");break;case"center":b._printErrorMessage(b,"ERROR: y == center not supported yet");break;default:c=0}}b.framePosition.x=a;b.framePosition.y=c},getFramePosition:function(a,b){b=typeof b!=="undefined"?b:"both_x_and_y";if(b=="x"){return parseInt(a.framePosition.x,10)}else{if(b=="y"){return parseInt(a.framePosition.y,10)}else{return{x:parseInt(a.framePosition.x,10),y:parseInt(a.framePosition.y,10)}}}},_setDwellRate:function(b,f){if(f=="init"){b.frameDwell=b.options.initdwell;b.dwellStepRate=(b.options.maxdwell-b.options.mindwell)/b.options.nsteps;for(var d=0;d<b.imageFrames.length;d++){b.frameDwellPause[d]=1;b.frameDwellPauseCounter[d]=b.frameDwellPause[d]}if(b.options.frame_pause!=null&&typeof b.options.frame_pause=="string"){var g=b.options.frame_pause.split(/[ ]*,[ ]*/);var c=[];var h,a;for(var d=0;d<g.length;d++){c=g[d].split(":");h=parseInt(c[0],10);a=parseInt(c[1],10);b.frameDwellPause[h]=a;b.frameDwellPauseCounter[h]=b.frameDwellPause[h]}}b.frameDwellPause[0]=parseInt(b.options.first_frame_pause,10);b.frameDwellPauseCounter[0]=b.frameDwellPause[0];b.frameDwellPause[b.imageFrames.length-1]=parseInt(b.options.last_frame_pause,10);b.frameDwellPauseCounter[b.imageFrames.length-1]=b.frameDwellPause[b.imageFrames.length-1]}else{if(f=="faster"){var e=b.frameDwell-b.dwellStepRate;if(e<b.options.mindwell){e=b.options.mindwell}b.frameDwell=e}else{var e=b.frameDwell+b.dwellStepRate;if(e>b.options.maxdwell){e=b.options.maxdwell}b.frameDwell=e}}},_propExists:function(c){var a=Array.prototype.slice.call(arguments),c=a.shift();for(var b=0;b<a.length;b++){if(!c||!c.hasOwnProperty(a[b])){return false}c=c[a[b]]}return true},_bindEvent:function(b,c){var a={};a[b]=c;this._on(this.element,a)},_disableTextSelect:function(a){a.each(function(){$(this).css("MozUserSelect","none");$(this).bind("selectstart",function(){return false});$(this).mousedown(function(){return false})})},_printErrorMessage:function(a,b){a._stopAnimation(a);$(a.element).find(".jsani-error-message").remove();$(a.element).append('<div class="jsani-error-message">'+b+"</div>")},isCanvasSupported:function(){var a=document.createElement("canvas");return !!(a.getContext&&a.getContext("2d"))},resizeAnim:function(a,b){this._stopAnimation(this);this._setLabel(this,"stopplay","opposite_state");this.animIsZoomed=true;if(this.animIsZoomed){this.animIsZoomed=false;this._setLabel(this,"zoom","zoom");this._unzoom(this);this._closeZoomHelp(this)}else{this.animIsZoomed=true;this._setLabel(this,"zoom","resetzoom");this.setFramePosition(this,"center","top");this.dragAni.init(this)}this.initFrameWidth=null;this.options.aniWidth=a;this.options.aniHeight=b;this.element.width(this.options.aniWidth);this.element.height(this.options.aniHeight);this.options.aniHeight=this.options.aniHeight-this.controlHeight;this.ctx.canvas.width=this.options.aniWidth;this.ctx.canvas.height=this.options.aniHeight;this.element.find("canvas").eq(0).width(this.options.aniWidth);this.element.find("canvas").eq(0).height(this.options.aniHeight);this.setFrameSize();this.setFramePosition(this,"center","top");this._drawFrame(this,"redraw");this._playAnimation(this);this._setLabel(this,"stopplay","opposite_state")},getCookieValue:function(d){var c=document.cookie;var a=c.indexOf(" "+d+"=");if(a==-1){a=c.indexOf(d+"=")}if(a==-1){c=null}else{a=c.indexOf("=",a)+1;var b=c.indexOf(";",a);if(b==-1){b=c.length}c=unescape(c.substring(a,b))}return c},setCookie:function(g,f,b,c){f=escape(f);if(c==""){var e=5*12*30*24*60;var a=new Date();var d=new Date().getTime();a.setTime(d+(1000*60*e));c=a.toGMTString()}if(b!=""){b=";Path="+b}document.cookie=g+"="+f+";expires="+c+b},deleteCookie:function(a){setCookie(a,"","","Thu, 01-Jan-70 00:00:01 GMT")}};
var _JSANI_CONTROLS={_defaultControls:function(){var b=this;var a={previous:{htmlContainer:'<div class="jsani-button '+this._controlClassName("previous")+'"></div>',label:"&lt;",defaultEventHandlers:{click:function(){b._showPrevFrame(b)}}},stopplay:{htmlContainer:'<div class="jsani-button '+this._controlClassName("stopplay")+'"></div>',label:{stop:"stop",play:"play"},defaultEventHandlers:{click:function(){b._toggleStopPlay(b)}}},next:{htmlContainer:'<div class="jsani-button '+this._controlClassName("next")+'"></div>',label:"&gt;",defaultEventHandlers:{click:function(){b._showNextFrame(b)}}},slow:{htmlContainer:'<div class="jsani-button '+this._controlClassName("slow")+'"></div>',label:"slower",defaultEventHandlers:{click:function(){b._slowDownAnim(b)}}},fast:{htmlContainer:'<div class="jsani-button '+this._controlClassName("fast")+'"></div>',label:"faster",defaultEventHandlers:{click:function(){b._speedUpAnim(b)}}},refresh:{htmlContainer:'<div class="jsani-button '+this._controlClassName("refresh")+'"></div>',label:"refresh",defaultEventHandlers:{click:function(){b._refreshAnim(b)}}},looprock:{htmlContainer:'<div class="jsani-button '+this._controlClassName("looprock")+'"></div>',label:{rock:"rock",loop:"loop"},defaultEventHandlers:{click:function(){b._toggleLoopRock(b)}}},zoom:{htmlContainer:'<div class="jsani-button '+this._controlClassName("zoom")+'"></div>',label:{zoom:"zoom",resetzoom:"unzoom"},defaultEventHandlers:{click:function(){b._zoomAnim(b)}}},firstframe:{htmlContainer:'<div class="jsani-button '+this._controlClassName("firstframe")+'"></div>',label:"|&lt;",defaultEventHandlers:{click:function(){b._showFrame(b,"first","pause")}}},lastframe:{htmlContainer:'<div class="jsani-button '+this._controlClassName("lastframe")+'"></div>',label:"&gt;|",defaultEventHandlers:{click:function(){b._showFrame(b,"last","pause")}}},framelabel:{htmlContainer:'<div class="jsani-button '+this._controlClassName("framelabel")+'"></div>',label:this._getFrameLabelsHTML()}};a.startstop=a.stopplay;a.speed=a.slowfast;return a},_updateControlList:function(f){var f=(Array.isArray(f))?f.slice():$.extend(true,{},f);var b=this._defaultControls();if(Array.isArray(f)){var e={controlList:{},controlLocation:this.defaultControlsLocation};for(var d=0;d<f.length;d++){if(f[d] in b){e.controlList[f[d]]={label:b[f[d]].label,customClass:null}}}f=e}else{if(f.controlList.hasOwnProperty("framelabel")&&f.controlList.framelabel.hasOwnProperty("label")){f.controlList.framelabel.label=b.framelabel.label}}for(var a in f.controlList){if(!(a in b)){delete f.controlList[a]}}return f},_createControls:function(h){var b=this._defaultControls();var j=this._getControlLocation(this.options.controls);var d='<div class="jsani-control-set">';for(var g in h.controlList){if(g=="framelabel"){continue}d+=b[g].htmlContainer}d+="</div>";var a="";if("framelabel" in h.controlList){a='<div class="jsani-control-set">'+b.framelabel.htmlContainer+"</div>"}if(j=="top"){d='<div class="jsani-controls-container">'+d+a+"</div>"}else{if(j=="bottom"){d='<div class="jsani-controls-container">'+a+d+"</div>"}else{this._printErrorMessage(this,"ERROR: the controls location specified is not implemented")}}var e=$(d);var k=null;var i=null;for(var g in h.controlList){k=this._controlClassName(g);if("label" in h.controlList[g]){i=this._getLabel(this,h.controlList[g],g,"opposite_state")}else{i=this._getLabel(this,b[g],g,"opposite_state")}e.find("."+k).html(i).addClass(h.controlList[g].customClass)}e.addClass("jsani-controls-"+j);this.element.find(".jsani-controls-container").remove();e.appendTo(this.element);for(var g in h.controlList){for(var f in b[g].defaultEventHandlers){this.getControl(g).bind(f,b[g].defaultEventHandlers[f])}}return{location:j,height:this.element.find(".jsani-controls-container").outerHeight(true)}},_getFrameLabelsHTML:function(){var b='<ul class="jsani-frame-labels">';for(var a=0;a<this.options.frameLabels.length;a++){b+='<li value="'+a+'" title="'+this.options.frameLabels[a].replace(/<(?:.|\n)*?>/gm,"")+'">'+this.options.frameLabels[a]+"</li>"}b+="</ul>";return b},_getLabel:function(a,e,d,b){if(typeof e.label=="string"){return e.label}else{if(b=="current_state"||b=="opposite_state"){switch(d){case"stopplay":if(b=="current_state"){b=(a.animIsStopped)?"stop":"play"}else{b=(a.animIsStopped)?"play":"stop"}break;case"looprock":if(b=="current_state"){b=(a.animIsLooping)?"loop":"rock"}else{b=(a.animIsLooping)?"rock":"loop"}break;case"zoom":if(b!="zoom"&&b!="resetzoom"){if(b=="current_state"){b=(a.animIsZoomed)?"zoom":"resetzoom"}else{b=(a.animIsZoomed)?"resetzoom":"zoom"}}break;default:a._printErrorMessage(a,"ERROR: label requested for invalid control")}}return e.label[b]}},_setLabel:function(a,c,b){a.getControl(c).html(a._getLabel(a,a.options.controls.controlList[c],c,b))},_showPrevFrame:function(a){if(!a.animIsStopped){a._stopAnimation(a);a.getControl("stopplay").html(a._getLabel(a,a.options.controls.controlList.stopplay,"stopplay","play"))}a._drawFrame(a,"backward");if(a._propExists(a.options.controls,"controlList","previous","onclick")){a.options.controls.controlList.previous.onclick(a)}},_toggleStopPlay:function(a){console.log("_toggleStopPlay called");if(a.animIsStopped){a._playAnimation(a)}else{a._stopAnimation(a)}a._setLabel(a,"stopplay","opposite_state");if(a._propExists(a.options.controls,"controlList","stopplay","onclick")){a.options.controls.controlList.stopplay.onclick(a)}},_showNextFrame:function(a){if(!a.animIsStopped){a._stopAnimation(a);a.getControl("stopplay").html(a._getLabel(a,a.options.controls.controlList.stopplay,"stopplay","play"))}a._drawFrame(a,"forward");if(a._propExists(a.options.controls,"controlList","next","onclick")){a.options.controls.controlList.next.onclick(a)}},_showFrame:function(b,c,a){if(a=="pause"&&!b.animIsStopped){b._stopAnimation(b);b.getControl("stopplay").html(b._getLabel(b,b.options.controls.controlList.stopplay,"stopplay","play"))}b._drawFrame(b,c);if(c=="first"){if(b._propExists(b.options.controls,"controlList","firstframe","onclick")){b.options.controls.controlList.firstframe.onclick(b)}}else{if(c=="last"){if(b._propExists(b.options.controls,"controlList","lastframe","onclick")){b.options.controls.controlList.lastframe.onclick(b)}}}},_slowDownAnim:function(a){a._setDwellRate(a,"slower");a._playAnimation(a);if(a.frameDwell>=a.options.maxdwell){a.getControl("slow").addClass("jsani-disabled-button")}else{a.getControl("slow").removeClass("jsani-disabled-button")}if(a.frameDwell<=a.options.mindwell){a.getControl("fast").addClass("jsani-disabled-button")}else{a.getControl("fast").removeClass("jsani-disabled-button")}if(a._propExists(a.options.controls,"controlList","slow","onclick")){a.options.controls.controlList.slow.onclick(a)}},_speedUpAnim:function(a){a._setDwellRate(a,"faster");a._playAnimation(a);if(a.frameDwell>=a.options.maxdwell){a.getControl("slow").addClass("jsani-disabled-button")}else{a.getControl("slow").removeClass("jsani-disabled-button")}if(a.frameDwell<=a.options.mindwell){a.getControl("fast").addClass("jsani-disabled-button")}else{a.getControl("fast").removeClass("jsani-disabled-button")}if(a._propExists(a.options.controls,"controlList","fast","onclick")){a.options.controls.controlList.fast.onclick(a)}},_refreshAnim:function(a){console.log("_refreshAnim called");if(a._propExists(a.options.controls,"controlList","refresh","onclick")){a.options.controls.controlList.refresh.onclick(a)}},_toggleLoopRock:function(a){if(a.animIsLooping){a.animIsLooping=false}else{a.animIsLooping=true}a._setLabel(a,"looprock","opposite_state");if(a._propExists(a.options.controls,"controlList","looprock","onclick")){a.options.controls.controlList.looprock.onclick(a)}},_zoomAnim:function(c){if(c.animIsZoomed){c.animIsZoomed=false;c._setLabel(c,"zoom","zoom");c._unzoom(c)}else{c.animIsZoomed=true;c._setLabel(c,"zoom","resetzoom");c.setFramePosition(c,"center","top");c.dragAni.init(c)}var e=c.options.showzoomHelp&&c.animIsZoomed&&c.getCookieValue("jsani-never_show_zoom_help")!="true"&&$(c.element).find(".jsani-zoom-help").length==0;if(e){var a=this._getControlLocation(this.options.controls);var d;if(a=="top"){d="top"}else{d="bottom"}var b=c._getLabel(c,c.options.controls.controlList.zoom,"zoom","resetzoom");$(c.element).find(".jsaniCanvas").before('<div class="jsani-zoom-help"><div>You are in zoom mode - instructions:<ul><li><strong>Zoom in:</strong> click on the animation</li><li><strong>Zoom out:</strong> hold down the CTRL button when clicking or click on the "'+b+'" button</li><li><strong>Roam:</strong> hold down the mouse button and drag on the image</li></ul><div class="jsani-zoom-help-buttons"><input type="button" class="jsani-close-zoom-help-button" value="Close"> <input type="button" class="jsani-nevershow-zoom-help-button" value="Never show this again"></div></div></div>');$(c.element).find(".jsani-zoom-help").css(d,c.controlHeight+"px");$(c.element).find(".jsani-zoom-help").children("div").css("max-height",($(c.element).height()-c.controlHeight)+"px");$(c.element).find(".jsani-zoom-help").find('input[type="button"]').bind("click",function(){if($(this).hasClass("jsani-close-zoom-help-button")){c._closeZoomHelp(c)}else{if($(this).hasClass("jsani-nevershow-zoom-help-button")){c.setCookie("jsani-never_show_zoom_help","true","","");c._closeZoomHelp(c)}}})}else{c._closeZoomHelp(c)}if(c._propExists(c.options.controls,"controlList","zoom","onclick")){c.options.controls.controlList.zoom.onclick(c)}},_closeZoomHelp:function(a){$(a.element).find(".jsani-zoom-help").remove()},_stopAnimation:function(a){window.clearInterval(a.intervalID);a.animIsStopped=true},_playAnimation:function(a){if(a.frameDwell==null){a._setDwellRate(a,"init")}if(a.intervalID!=null){window.clearInterval(a.intervalID)}a.intervalID=window.setInterval(function(){a._drawFrame(a)},a.frameDwell);a.animIsStopped=false;a.getControl("stopplay").html(a._getLabel(a,a.options.controls.controlList.stopplay,"stopplay","stop"))},_controlClassName:function(a){return"jsani-"+a+"-button"},getControl:function(a){if(this.element.find("."+this._controlClassName(a)).length){return this.element.find("."+this._controlClassName(a)).eq(0)}else{return null}},_getControlLocation:function(a){if(Array.isArray(a)||!("controlLocation" in a)){return this.defaultControlsLocation}else{return a.controlLocation}},_zoomFrame:function(c,h){if(c.dragAni.aniWasMoved||!c.animIsZoomed){return}var f=$(c.element).find("canvas").offset();var d=((h.clientX+$(window).scrollLeft())-(c.getFramePosition(c,"x")+parseInt(f.left,10)))/c.zoomLevel;var b=((h.clientY+$(window).scrollTop())-(c.getFramePosition(c,"y")+parseInt(f.top,10)))/c.zoomLevel;if(h.ctrlKey){c.zoomLevel=c.zoomLevel/c.zoomFactor;if(c.zoomLevel<1){c.zoomLevel=1}}else{c.zoomLevel=c.zoomLevel*c.zoomFactor}c.setFrameSize(parseInt(Math.round(c.initFrameWidth*c.zoomLevel),10),parseInt(Math.round(c.initFrameHeight*c.zoomLevel),10));var a=$(c.element).children("canvas").eq(0).offset();var i=parseInt(h.pageX,10)-a.left;var g=parseInt(h.pageY,10)-a.top;c.setFramePosition(c,parseInt(Math.round(i-d*c.zoomLevel),10),parseInt(Math.round(g-b*c.zoomLevel),10));c._drawFrame(c,"redraw")},_unzoom:function(a){a.zoomLevel=1;a.animIsZoomed=false;a.setFrameSize();a.setFramePosition(a,"center","top");a._drawFrame(a,"redraw")}};
var _JSANI_DRAGANI={dragAni:{parent:null,isdrag:false,initFramePos:null,initMousePos:{x:0,y:0},aniWasMoved:false,init:function(b){var a=this;a.parent=b;a.parent.element.bind("mousedown",function(c){a.startDrag(c,a)});a.parent.element.bind("mouseup",function(c){a.isdrag=false})},movemouse:function(b,a){if(a.isdrag&&a.parent.animIsZoomed){a.aniWasMoved=true;a.parent.setFramePosition(a.parent,a.initFramePos.x+b.clientX-a.initMousePos.x,a.initFramePos.y+b.clientY-a.initMousePos.y);if(a.parent.animIsStopped){a.parent._drawFrame(a.parent,"redraw")}return false}},startDrag:function(b,a){a.isdrag=true;a.initFramePos=a.parent.getFramePosition(a.parent);a.initMousePos.x=b.clientX;a.initMousePos.y=b.clientY;a.aniWasMoved=false;a.parent.element.bind("mousemove",function(c){a.movemouse(c,a)});return false}}};
(function(b){var a=b.extend(true,{},_JSANI_BASE,_JSANI_CONTROLS,_JSANI_DRAGANI);b.widget("jsani.jsani",a)})(jQuery,_JSANI_BASE,_JSANI_CONTROLS,_JSANI_DRAGANI);
